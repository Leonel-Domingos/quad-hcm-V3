<?php/* *  @autor      Pedro Mengo de Abreu *  @versão     1.0 *  @revisão    2019.12.26 *  @copyright  (c) 2018 QuadSystems - http://www.quad-systems.com *  @nome     	quad_requests_lib.php *  @descrição  Controlador genérico para implementar pedidos específicos via AJAX * */# cabeçaho do controladorrequire_once 'quad_head_controller.php';$debug = false;$ajax_id = @$_REQUEST['request_id'];$msg = '';//PMA: Sem estes comentários dá erro e não me parece fazer qq sentido testar aqui à variável $msg!!!//if ($msg == '') {    if ($ajax_id == 'getHorarioDiario') {                $myArray = json_decode($_REQUEST['params']);                $empresa = '';        $rhid = '';        $dt_adm = '';        $dia = '';                if (isset($myArray->empresa)) {            $empresa = $myArray->empresa;        }        if (isset($myArray->rhid)) {            $rhid = $myArray->rhid;        }        if (isset($myArray->dt_adm)) {            $dt_adm = $myArray->dt_adm;        }        if (isset($myArray->dia)) {            $dia = $myArray->dia;        }                $inclui_indisp = 'N';        $data = new stdClass();        if ($empresa != '' && $rhid != '' && $dt_adm != '' && $dia != '') {            $dia = substr($dia,0,10);            rhid_horario_diario($empresa, $rhid, $dt_adm, $dia, $inclui_indisp,                                $data->origem, $data->hor, $data->e_1, $data->s_1, $data->e_2, $data->s_2,                                $data->he_1, $data->hs_1, $data->he_2, $data->hs_2, $data->he_3, $data->hs_3, $data->inic_dia, $data->e_noct, $data->s_noct,                                $data->hor_esp_min, $data->hor_esp_hrs,                                $data->indisp_fer, $data->indisp_dc, $data->indisp_aus, $data->indisp_bh,                                $data->bh, $data->th, $data->bh_transp, $data->th_transp,                                $data->cd_turno, $data->dsp_turno,                                $msg);        }                if ($msg == '') {            echo json_encode($data);        }    }     else if ($ajax_id == 'getAnoAberto') {        $empresa = $_REQUEST['empresa'];        $res = getAnoAberto ($empresa, $msg);        if ($msg == '') {            echo json_encode($res);        }    }     else if ($ajax_id == 'getRhidFerias') {        $myArray = json_decode($_REQUEST['params']);        $res = array();        if (isset($myArray->empresa) && isset($myArray->rhid) &&             isset($myArray->dt_adm) && isset($myArray->ano)) {            $res = getRhidFerias ($myArray, $msg);        }        if ($msg == '') {            echo json_encode($res);                    }    }     else if ($ajax_id == 'getRhidTS') {        $myArray = json_decode($_REQUEST['params']);        $empresa = '';        $rhid = '';        $ano = '';                if (isset($myArray->empresa)) {            $empresa = $myArray->empresa;        }        if (isset($myArray->rhid)) {            $rhid = $myArray->rhid;        }        if (isset($myArray->dt_adm)) {            $dt_adm = $myArray->dt_adm;        }                if (isset($myArray->ano)) {            $ano = $myArray->ano;        }                  $res = getRhidTS ($empresa, $rhid, $dt_adm, $ano, $msg);        if ($msg == '') {            echo json_encode($res);                    }    }     else if ($ajax_id == 'getRhidDC') {        $myArray = json_decode($_REQUEST['params']);        $res = array();        if (isset($myArray->empresa) && isset($myArray->rhid) &&             isset($myArray->dt_adm)) {            $res = getRhidDC ($myArray, $msg);        }                        if ($msg == '') {            echo json_encode($res);                    }            }     else if ($ajax_id == 'getRhidAdaptabilidades') {        $myArray = json_decode($_REQUEST['params']);        $res = array();        if (isset($myArray->empresa) && isset($myArray->rhid) &&             isset($myArray->dt_adm)) {            $res = getRhidAdaptabilidades ($myArray, $msg);        }                if ($msg == '') {            echo json_encode($res);                    }    }     else if ($ajax_id == 'getTimeDuration') {        $myArray = json_decode($_REQUEST['params']);        $empresa = '';        $rhid = '';        $dt_adm = '';        $dt_ini = '';        $dt_fim = '';        $resource = new stdClass();        $resource->tabela = "";        $resource->empresa = "";        $resource->rhid = "";        $resource->dt_adm = "";        $resource->dt_ini = "";        $resource->dt_fim = "";        if (isset($myArray->tabela)) {            $resource->tabela = $myArray->tabela;        }        if (isset($myArray->empresa)) {            $resource->empresa = $myArray->empresa;        }        if (isset($myArray->rhid)) {            $resource->rhid = $myArray->rhid;        }        if (isset($myArray->dt_adm)) {            $resource->dt_adm = $myArray->dt_adm;        }                if (isset($myArray->dt_ini)) {            $resource->dt_ini = $myArray->dt_ini;        }                if (isset($myArray->dt_fim)) {            $resource->dt_fim = $myArray->dt_fim;        }                if (isset($myArray->tp_ocorrencia)) {            $resource->tp_ocorrencia = $myArray->tp_ocorrencia;        }                        $res = contabilizacao_registo ($resource, $msg);        if ($msg == '') {            echo json_encode($res);                    } else {            $dadosOut = array(                "error" => $msg            );             echo json_encode($dadosOut);                    }    }    //}if ($msg != '') {    $msg = str_replace("ORA-20000: ", "", $msg);    //$msg = str_replace('"', "", $msg);    //$msg = str_replace("'", "", $msg);    $pos = strpos($msg, "EOM");    if ($pos) {        $msg = substr($msg, 0, $pos);    }    $dadosOut = array(        "error" => $msg    );    echo json_encode($dadosOut);    //echo "ERRO: " . $msg;}?>